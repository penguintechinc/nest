apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "nest.fullname" . }}-config
  namespace: {{ .Release.Namespace | quote }}
  labels:
    {{- include "nest.labels" . | nindent 4 }}
data:
  # Flask/Python application configuration
  log-level: {{ .Values.config.flask.logLevel | quote }}
  environment: {{ .Values.config.flask.environment | quote }}

  # Database configuration
  database-type: {{ .Values.database.type | quote }}
  database-host: {{ .Values.database.externalConnection.host | quote }}
  database-port: {{ .Values.database.externalConnection.port | quote }}
  database-name: {{ .Values.database.externalConnection.database | quote }}

  # Cache (Redis/Valkey) configuration
  cache-host: {{ .Values.cache.externalConnection.host | quote }}
  cache-port: {{ .Values.cache.externalConnection.port | quote }}
  cache-tls-enabled: {{ .Values.cache.externalConnection.tls | quote }}

  # License server configuration
  license-server-url: {{ .Values.config.license.serverUrl | quote }}
  license-enabled: {{ .Values.config.license.enabled | quote }}
  license-cache-expiry: {{ .Values.config.license.cacheExpiry | quote }}

  # Monitoring configuration
  metrics-enabled: {{ .Values.config.monitoring.metricsEnabled | quote }}
  metrics-port: {{ .Values.config.monitoring.metricsPort | quote }}
  metrics-path: {{ .Values.config.monitoring.metricsPath | quote }}

  # Security configuration
  cors-enabled: {{ .Values.config.security.corsEnabled | quote }}
  cors-origins: {{ .Values.config.security.corsOrigins | quote }}
  tls-enabled: {{ .Values.config.security.tlsEnabled | quote }}

  # Application configuration file (if needed)
  app-config.yaml: |
    app:
      name: {{ .Values.app.name }}
      environment: {{ .Values.config.flask.environment }}
      debug: {{ .Values.config.flask.debug }}

    database:
      type: {{ .Values.database.type }}
      host: {{ .Values.database.externalConnection.host }}
      port: {{ .Values.database.externalConnection.port }}
      name: {{ .Values.database.externalConnection.database }}

    cache:
      host: {{ .Values.cache.externalConnection.host }}
      port: {{ .Values.cache.externalConnection.port }}
      tls: {{ .Values.cache.externalConnection.tls }}

    license:
      serverUrl: {{ .Values.config.license.serverUrl }}
      enabled: {{ .Values.config.license.enabled }}
      cacheExpiry: {{ .Values.config.license.cacheExpiry }}

    monitoring:
      metricsEnabled: {{ .Values.config.monitoring.metricsEnabled }}
      metricsPort: {{ .Values.config.monitoring.metricsPort }}
      metricsPath: {{ .Values.config.monitoring.metricsPath }}

    security:
      corsEnabled: {{ .Values.config.security.corsEnabled }}
      corsOrigins: {{ .Values.config.security.corsOrigins }}
      tlsEnabled: {{ .Values.config.security.tlsEnabled }}
