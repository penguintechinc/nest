# Default values for nest.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

global:
  namespace: nest
  imagePullPolicy: IfNotPresent
  imageRegistry: ""

# PostgreSQL 16 Database
postgres:
  enabled: true
  image:
    repository: postgres
    tag: "16-alpine"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 5432
  env:
    POSTGRES_DB: nest
    POSTGRES_USER: nest
    POSTGRES_PASSWORD: nest123
    POSTGRES_INITDB_ARGS: "--encoding=UTF-8 --lc-collate=C --lc-ctype=C"
  persistence:
    enabled: true
    size: 10Gi
    storageClass: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# Redis 7 Cache Layer
redis:
  enabled: true
  image:
    repository: redis
    tag: "7-alpine"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 6379
  env:
    REDIS_PASSWORD: nest123
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Go API Service
api:
  enabled: true
  image:
    repository: nest-api
    tag: "latest"
    pullPolicy: IfNotPresent
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
  env:
    DB_HOST: postgres
    DB_PORT: "5432"
    DB_NAME: nest
    DB_USER: nest
    DB_PASSWORD: nest123
    REDIS_HOST: redis
    REDIS_PORT: "6379"
    REDIS_PASSWORD: nest123
    JWT_SECRET: dev-secret-key-change-in-prod
    PORT: "8080"
    GIN_MODE: release
    LOG_LEVEL: info
    ENVIRONMENT: production
    LICENSE_KEY: PENG-XXXX-XXXX-XXXX-XXXX-ABCD
    PRODUCT_NAME: nest
    LICENSE_SERVER_URL: https://license.penguintech.io
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  healthCheck:
    enabled: true
    path: /healthz
    initialDelaySeconds: 15
    periodSeconds: 30
    timeoutSeconds: 10

# Python Manager Service
manager:
  enabled: true
  image:
    repository: nest-manager
    tag: "latest"
    pullPolicy: IfNotPresent
  replicaCount: 1
  service:
    type: ClusterIP
    port: 8000
    targetPort: 8000
  env:
    DB_HOST: postgres
    DB_PORT: "5432"
    DB_NAME: nest
    DB_USER: nest
    DB_PASSWORD: nest123
    REDIS_HOST: redis
    REDIS_PORT: "6379"
    REDIS_PASSWORD: nest123
    PORT: "8000"
    ENVIRONMENT: production
    DEBUG: "false"
    LOG_LEVEL: INFO
    LICENSE_KEY: PENG-XXXX-XXXX-XXXX-XXXX-ABCD
    PRODUCT_NAME: nest
    LICENSE_SERVER_URL: https://license.penguintech.io
    PYTHONUNBUFFERED: "1"
    PYTHONDONTWRITEBYTECODE: "1"
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"
  healthCheck:
    enabled: true
    path: /healthz
    initialDelaySeconds: 15
    periodSeconds: 30
    timeoutSeconds: 10

# React Frontend
web:
  enabled: true
  image:
    repository: nest-web
    tag: "latest"
    pullPolicy: IfNotPresent
  replicaCount: 1
  service:
    type: ClusterIP
    port: 3000
    targetPort: 3000
  env:
    NODE_ENV: production
    PORT: "3000"
    VITE_API_URL: http://api:8080
    VITE_MANAGER_URL: http://manager:8000
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  healthCheck:
    enabled: true
    path: /
    initialDelaySeconds: 30
    periodSeconds: 30
    timeoutSeconds: 10

# Prometheus Metrics Collection
prometheus:
  enabled: false
  image:
    repository: prom/prometheus
    tag: "latest"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 9090
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# Grafana Dashboard
grafana:
  enabled: false
  image:
    repository: grafana/grafana
    tag: "latest"
  replicaCount: 1
  service:
    type: ClusterIP
    port: 3000
  env:
    GF_SECURITY_ADMIN_USER: admin
    GF_SECURITY_ADMIN_PASSWORD: admin123
    GF_USERS_ALLOW_SIGN_UP: "false"
    GF_INSTALL_PLUGINS: grafana-piechart-panel
  persistence:
    enabled: true
    size: 5Gi
    storageClass: ""
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

# Ingress Configuration
ingress:
  enabled: false
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: nest.local
      paths:
        - path: /
          pathType: Prefix
          service: web
          port: 3000
        - path: /api
          pathType: Prefix
          service: api
          port: 8080
        - path: /manager
          pathType: Prefix
          service: manager
          port: 8000
  tls:
    - secretName: nest-tls
      hosts:
        - nest.local

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Pod Security Context
podSecurityContext:
  fsGroup: 2000
  runAsNonRoot: true
  runAsUser: 1000

# Security Context
securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false

# Node Selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
