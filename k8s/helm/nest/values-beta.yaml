# Beta environment values for nest
# Pre-production/staging environment

global:
  namespace: nest-beta
  imagePullPolicy: Always
  imageRegistry: registry-dal2.penguintech.io

# PostgreSQL
postgres:
  replicaCount: 1
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

# Redis
redis:
  replicaCount: 2
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# Go API Service
api:
  replicaCount: 2
  image:
    repository: registry-dal2.penguintech.io/nest-api
    pullPolicy: Always
  env:
    GIN_MODE: release
    LOG_LEVEL: INFO
    ENVIRONMENT: beta
    RELEASE_MODE: "true"
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

# Python Manager Service
manager:
  replicaCount: 2
  image:
    repository: registry-dal2.penguintech.io/nest-manager
    pullPolicy: Always
  env:
    ENVIRONMENT: beta
    DEBUG: "false"
    LOG_LEVEL: INFO
    RELEASE_MODE: "true"
  resources:
    requests:
      memory: "512Mi"
      cpu: "500m"
    limits:
      memory: "2Gi"
      cpu: "2000m"

# React Frontend
web:
  replicaCount: 2
  image:
    repository: registry-dal2.penguintech.io/nest-web
    pullPolicy: Always
  env:
    NODE_ENV: production
    VITE_API_URL: https://nest.penguintech.cloud/api
    VITE_MANAGER_URL: https://nest.penguintech.cloud/manager
  resources:
    requests:
      memory: "256Mi"
      cpu: "250m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

# Prometheus - enabled in beta
prometheus:
  enabled: true
  persistence:
    enabled: true
    size: 50Gi

# Grafana - enabled in beta
grafana:
  enabled: true
  persistence:
    enabled: true
    size: 10Gi

# Ingress - enabled in beta
ingress:
  enabled: true
  className: nginx
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    nginx.ingress.kubernetes.io/proxy-body-size: "50m"
  hosts:
    - host: nest.penguintech.cloud
      paths:
        - path: /
          pathType: Prefix
          service: web
          port: 3000
        - path: /api
          pathType: Prefix
          service: api
          port: 8080
        - path: /manager
          pathType: Prefix
          service: manager
          port: 8000
  tls:
    - secretName: nest-tls
      hosts:
        - nest.penguintech.cloud

# Pod Security - strict for beta
podSecurityContext:
  fsGroup: 2000
  runAsNonRoot: true
  runAsUser: 1000

securityContext:
  capabilities:
    drop:
    - ALL
  readOnlyRootFilesystem: false
  allowPrivilegeEscalation: false
